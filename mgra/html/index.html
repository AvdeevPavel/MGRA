<!DOCTYPE html>
<html>
<head>	
	<title>MGRA</title>
	<style>
		 #menu { 
    		float: left; 
    		width: 200px; 
    		padding: 5px; 
		    margin: 10px 10px 20px 5px; 
   		}

		#content_text { 
			float: left; 
		    margin: 2px 5px 0px 5px; 
		    padding: 5px; 
			width: 150px; 
   		}

		#content_text1 { 
			float: left; 
		    margin: 10px 5px 20px 5px; 
		    padding: 5px; 
			width: 150px; 
   		}

		#content { 
		    margin: 10px 5px 20px 225px; 
		    padding: 5px; 
   		}

		#right_text { 
			float: left; 
    		width: 100px; 
    		padding: 5px; 
		    margin: 70px 10px 20px 5px; 
		} 
	</style>

	<script type = "text/javascript">	
		var genomeCountGrm = 0;
		var genomeCountInf = 0; 

		/*Grimm format functions*/
        function addGenomeGrm() {
            genomeCountGrm++;
            var table = document.getElementById("grm_genomes");
            var row = table.insertRow(genomeCountGrm - 1);
            row.align = "left";
            row.vAlign = "top";
            var c = [];
            for (var j = 0; 1 > j; j++) {
                c[j] = row.insertCell(j);
                c[j].align = "left";
                c[j].vAlign = "top";
            }

            c[0].innerHTML =
                "<div id = \"right_text\"><strong>Genome " + genomeCountGrm + ":</strong></div>" +
                "<div id = \"content\"> <div>Name: <input size='1' id='grm_name" + genomeCountGrm + "' name='name" + genomeCountGrm + 
				"'> Aliases <input id='grm_alias" + genomeCountGrm + "'size='28' name='alias" + genomeCountGrm + "'></div>" +
                "<textarea id='grm_genome" + genomeCountGrm + "' name='genome" + genomeCountGrm + "' rows='6' cols='60'></textarea></div>";
        }

		function initGenomesGrm(n) {
            var table = document.getElementById("grm_genomes");
            for(var i = table.rows.length - 1; i >= 0; i--) {
                table.deleteRow(i);
            }
            genomeCountGrm = 0;
            for (var i = 0; i < n; i++) {
                addGenomeGrm();
            }
            clearFileGrm();
        }

		function clearGrimmFormat() { 
			initGenomesGrm(2);
			document.getElementById("grm_trees").value = '';
            document.getElementById("grm_stages").value = '3';
            document.getElementById("grm_target").value = '';
            document.getElementById("grm_completion").value = ''	
			showTargetGrm(false);
		} 

		function showTargetGrm(show) {
            document.getElementById('grm_targetDiv').style.display= show ? '' : 'none';
            document.getElementById('grm_targetControl').style.display=show ? 'none' : '';
            document.getElementById('grm_useTarget').value=show ? 1 : 0;
            return false;
        }

		function clearFileGrm() { 
			document.getElementById('grm_genome_file').value = '';
		} 

		function setGrimmFormat() { 
			clearGrimmFormat();
			document.getElementById('showInferCarsForm').style.display = 'none'; 
			document.getElementById('showGrimmForm').style.display = '';
		}

		/*InferCARs format functions*/
		function addGenomeInf() {
            genomeCountInf++;
            var table = document.getElementById("inf_genomes");
            var row = table.insertRow(genomeCountInf - 1);
            row.align = "left";
            row.vAlign = "top";
            var c = [];
            for (var j = 0; 1 > j; j++) {
                c[j] = row.insertCell(j);
                c[j].align = "left";
                c[j].vAlign = "top";
            }

            c[0].innerHTML =
                "<div id = \"content_text1\"><strong>Genome " + genomeCountInf + ":</strong></div>" +
                "<div id = \"content\"> <div>Name: <input size='1' id='inf_name" + genomeCountInf + "' name='name" + genomeCountInf + 
				"'> Aliases <input id='inf_alias" + genomeCountInf + "'size='28' name='alias" + genomeCountInf + "'></div></div>"
        }

		function initGenomesInf(n) {
            var table = document.getElementById("inf_genomes");
            for(var i = table.rows.length - 1; i >= 0; i--) {
                table.deleteRow(i);
            }
            genomeCountInf = 0;
            for (var i = 0; i < n; i++) {
                addGenomeInf();
            }
            clearFileInf();
        }
	
		function showTargetInf(show) {
            document.getElementById('inf_targetDiv').style.display= show ? '' : 'none';
            document.getElementById('inf_targetControl').style.display=show ? 'none' : '';
            document.getElementById('inf_useTarget').value=show ? 1 : 0;
            return false;
        }

        function clearFileInf() {
            document.getElementById('inf_genome_file').value = '';
        }

    	function clearInferCarsFormat() { 
			initGenomesInf(2); 
            document.getElementById("inf_genome").value = '';
            document.getElementById("inf_trees").value = '';
            document.getElementById("inf_stages").value = '3';
            document.getElementById("inf_target").value = '';
            document.getElementById("inf_completion").value = ''	
			showTargetInf(false);
		} 

		function setInferCarsFormat() { 
			clearInferCarsFormat();
			document.getElementById('showInferCarsForm').style.display = ''; 
			document.getElementById('showGrimmForm').style.display = 'none';	
		} 
	 
    	function loadFile(file) {
            var X = new XMLHttpRequest();
            X.open('GET', file, false );
            X.setRequestHeader('Content-Type', 'text/html')
            X.send('');
            return X.responseText;
        }

		/*Set example in file*/
	    function setMam6() {
            setInferCarsFormat(); 
			initGenomesInf(6); 

			document.getElementById("inf_name1").value = 'M';
            document.getElementById("inf_name2").value = 'R';
            document.getElementById("inf_name3").value = 'D';
            document.getElementById("inf_name4").value = 'Q';
            document.getElementById("inf_name5").value = 'H';
            document.getElementById("inf_name6").value = 'C';

            document.getElementById("inf_alias1").value = 'mouse mm9';
            document.getElementById("inf_alias2").value = 'rat rn4';
            document.getElementById("inf_alias3").value = 'dog canFam2';
            document.getElementById("inf_alias4").value = 'macaque rheMac2';
            document.getElementById("inf_alias5").value = 'human hg18';
            document.getElementById("inf_alias6").value = 'chimpanzee panTro2';

            document.getElementById("inf_genome").value = loadFile('mam6/blocks6.txt');
            document.getElementById("inf_trees").value = '(((M,R),D),(Q,(H,C)))';
            document.getElementById("inf_stages").value = '4';
            document.getElementById("inf_target").value = '';
            document.getElementById("inf_completion").value = '1299h 1300h 1300t 1301t R\r'+
                                                            '1289h 1290h 1290t 1291t D\r'+
                                                            '374t 376t oo 375h R\r'+
                                                            '927t 610h 610t 609h R\r'+
                                                            '79h 81t 80t 83h Q\r'+
                                                            '81t 83h 80h 84t Q\r'+
                                                            '794h 795t 795h 796t Q\r'+
                                                            '1196h 1198h 1202t 1199t D\r';
            showTargetInf(true);
        }

        function setMam7() {
            setInferCarsFormat();
			initGenomesInf(7); 

			document.getElementById("inf_name1").value = 'M';
            document.getElementById("inf_name2").value = 'R';
            document.getElementById("inf_name3").value = 'D';
            document.getElementById("inf_name4").value = 'Q';
            document.getElementById("inf_name5").value = 'H';
            document.getElementById("inf_name6").value = 'C';
            document.getElementById("inf_name7").value = 'O';

            document.getElementById("inf_alias1").value = 'mouse mm9';
            document.getElementById("inf_alias2").value = 'rat rn4';
            document.getElementById("inf_alias3").value = 'dog canFam2';
            document.getElementById("inf_alias4").value = 'macaque rheMac2';
            document.getElementById("inf_alias5").value = 'human hg18';
            document.getElementById("inf_alias6").value = 'chimpanzee panTro2';
            document.getElementById("inf_alias7").value = 'opossum monDom4'; 
            
            document.getElementById("inf_genome").value = loadFile('mam7/blocks7.txt');
            document.getElementById("inf_trees").value = '((M,R),DOQHC)\n' +
                                                     '(MRDO,(Q,(H,C)))';
            document.getElementById("inf_stages").value = '3';
            document.getElementById("inf_target").value = '';
            document.getElementById("inf_completion").value = '';
            showTargetInf(false);
        }

        function setMurphy05() {
			setGrimmFormat();
            initGenomesGrm(7);

            document.getElementById("grm_name1").value = 'H';
			document.getElementById("grm_alias1").value = 'human';
			document.getElementById("grm_genome1").value = loadFile('murphy05/murphy05_1.txt');

            document.getElementById("grm_name2").value = 'M';
            document.getElementById("grm_alias2").value = 'mouse';
			document.getElementById("grm_genome2").value = loadFile('murphy05/murphy05_2.txt');           

			document.getElementById("grm_name3").value = 'R';
            document.getElementById("grm_alias3").value = 'rat';
			document.getElementById("grm_genome3").value = loadFile('murphy05/murphy05_3.txt');           

            document.getElementById("grm_name4").value = 'C';
            document.getElementById("grm_alias4").value = 'cat';
			document.getElementById("grm_genome4").value = loadFile('murphy05/murphy05_4.txt');     	      

            document.getElementById("grm_name5").value = 'W';
            document.getElementById("grm_alias5").value = 'cattle';
			document.getElementById("grm_genome5").value = loadFile('murphy05/murphy05_5.txt');           

            document.getElementById("grm_name6").value = 'D';
            document.getElementById("grm_alias6").value = 'dog';
			document.getElementById("grm_genome6").value = loadFile('murphy05/murphy05_6.txt');           

            document.getElementById("grm_name7").value = 'P';
            document.getElementById("grm_alias7").value = 'pig';
			document.getElementById("grm_genome7").value = loadFile('murphy05/murphy05_7.txt');           

            document.getElementById("grm_trees").value = '((H,(M,R)),DCPW)\n'+
                                                     '((D,C),HRMPW)\n' +
                                                     '((P,W),HRMDC)';
			
            document.getElementById("grm_stages").value = '3';
            document.getElementById("grm_target").value = 'DCPW';
            document.getElementById("grm_completion").value = '';
            showTargetGrm(true);
        }

        function setToy05() {
			setGrimmFormat();
            initGenomesGrm(4);

            document.getElementById("grm_name1").value = '1';
			document.getElementById("grm_alias1").value = 'P1';
            document.getElementById("grm_genome1").value = loadFile('toy/toyblks_1.txt');
		
			document.getElementById("grm_name2").value = '2';
            document.getElementById("grm_alias2").value = 'P2';
		    document.getElementById("grm_genome2").value = loadFile('toy/toyblks_2.txt');
		        
			document.getElementById("grm_name3").value = '3';
            document.getElementById("grm_alias3").value = 'P3';
		    document.getElementById("grm_genome3").value = loadFile('toy/toyblks_3.txt');
		
            document.getElementById("grm_name4").value = '4';
            document.getElementById("grm_alias4").value = 'P4';
    		document.getElementById("grm_genome4").value = loadFile('toy/toyblks_4.txt');
		
            document.getElementById("grm_trees").value = '((1,2),(3,4))';

            document.getElementById("grm_stages").value = '3';
            document.getElementById("grm_target").value = '';
            document.getElementById("grm_completion").value = '';

            showTargetGrm(false);
        }

		function setRosaceae() { 
			setInferCarsFormat(); 
			initGenomesInf(3); 

			document.getElementById("inf_name1").value = 'P';
            document.getElementById("inf_name2").value = 'S';
            document.getElementById("inf_name3").value = 'V';
           
            document.getElementById("inf_alias1").value = 'pp prunus';
            document.getElementById("inf_alias2").value = 'fv fragaria';
            document.getElementById("inf_alias3").value = 'vv vitus';
            
            document.getElementById("inf_genome").value = loadFile('rosaceae/rosaceae.txt');
            document.getElementById("inf_trees").value = '((P,S),V)';
            document.getElementById("inf_stages").value = '3';
            document.getElementById("inf_target").value = 'PS';
            document.getElementById("inf_completion").value = '';
            showTargetInf(true);
		} 

	</script>
</head>
<body>
	<header> 
		<h1><p align="center"><a href="#">MGRA (Multiple Genome Rearrangements and Ancestors) web server, beta version</a></p></h1>
	</header>

	<nav id = "menu">
		<p> 
			<strong> Input formats: </strong> <br>
			<blockquote> 
				<a href="#" onclick="setInferCarsFormat(); return false;">infercars</a> <br>
				<a href="#" onclick="setGrimmFormat(); return false;">grimm</a> <br>
			</blockquote>	
			<strong> Examples: </strong> <br>
			<blockquote> 
				<a href="#" onclick="setMam6(); return false;">mam6</a> <br>
				<a href="#" onclick="setMam7(); return false;">mam7</a> <br>
		        <a href="#" onclick="setMurphy05(); return false;">murphy05</a> <br>
				<a href="#" onclick="setToy05(); return false;">toy</a> <br>
				<a href="#" onclick="setRosaceae(); return false;">rosaceae</a> <br>
			</blockquote>
			<a href="#" onclick="viewHelp(); return false;">How to work</a> <br>			
		</p>
	</nav>
	
		
	<!--Form for infercars format-->
	<div id = "showInferCarsForm"> <div id = "content">
		<form method="post" action="http://127.0.0.1:8080" enctype="multipart/form-data" name="inferCarsMgraForm">
		<input type="hidden" name="useFormat" id="inf_useFormat" value="infercars"/>
		<h2><p align="center">Genome in infercars format</p></h2>		

		<table id="inf_genomes">
	    </table>

	    <script>
	        initGenomesInf(2);
	    </script>
		
		<div align = "center"> <input name="add_genome" type="button" value="add genome" onclick="addGenomeInf(); return false;"/> </div>

		<p>
        	<div id ="content_text"> <strong>Genome file:</strong> </div> 
			<div id ="content"> <input type="file" id="inf_genome_file" name="genome_file"> <a href="#" onclick="clearFileInf();">Clear</a> </div>
	    </p>

		<div id ="right_text"> <strong>Genome:</strong></div>
		<div id ="content"> <textarea id='inf_genome' name='genome' rows='10' cols='60'></textarea></div>
		<p>
    	    <strong>Known subtrees of the phylogenetic tree of the above genomes in Newick format</strong><br>
    	    If no trees are given, MGRA assumes that only terminal branches are known (as in MGR).  
    	</p>
   		
		<div id = "content"> <textarea rows="5" cols="60" name="trees" id="inf_trees"></textarea></div>

	    <p>
	        <strong>The number of stages to perform</strong>&nbsp;&nbsp;&nbsp;<input type='text' size='5' name='stages' id="inf_stages" value="3"/><br>
	        <p style="text-indent: 25px;">
				Higher values correspond to less reliable heuristics.
		        The highest value is 4 and usually it still requires manual completion (see below).
		        Smaller values require 'target' specification to produce ancestral reconstruction.
	        	It is not recommended to have stages higher than 3 if no complete phylogenetic tree is known.
			</p>
	    </p>

	    <div id="inf_targetControl">
            <a href="#" onclick="return showTargetInf(true);">Show Target and Completion fields</a>
        </div>

        <div id="inf_targetDiv" style="display:none;">
    		<p>
    	    	<a href="#" onclick="return showTargetInf(false);">Remove Target and Completion fields</a>
	   		</p>

    		<p>
    	    	<strong>Target</strong>&nbsp;&nbsp;&nbsp;<input type='text' size='10' name='target' id="inf_target"/><br>
    	   		<p style="text-indent: 25px;">
					By default, MGRA reconstructs all ancestral genomes but it first has to complete transformation into an identity breakpoint graph.
		        	If 'target' is specified, MGRA focuses on reconstruction of the specified ancestral genome
		        	and can produce a partial reconstruction at any point (even if the transformation is not complete).
				</p>
    		</p>
		    <p style="text-indent: 25px;">	
		        Manual (human-assisted) completion of T-consistent transformation (the last stage of MGRA).
		        Each row contains exactly five terms: `a b c d E' denoting a 2-break operating on the \vec{T}-consistent multicolor E,
		        replacing the multiedges (a,b) and (c,d) with the multiedges (a,c) and (b,d).
		        'oo' stands for a chromosome end.
		        Manual completion can be derived from visual inspection of the breakpoint graph after MGRA Stage 3.
		    </p> 
			<div id = "content">
			    <textarea rows="5" cols="60" name="completion" id="inf_completion"></textarea>
		    </div>

		    <input type="hidden" name="useTarget" id="inf_useTarget" value="0"/>
		</div> 
			<p>
				<div align = "center"> 
			        <input type="submit" value="submit form"/>
				</div>
		    </p>
    </form>
	</div> </div>


	<!--Form for grimm format-->
	<div id = "showGrimmForm" style="display:none;"> <div id = "content">
	<form method="post" action="http://127.0.0.1:8080" enctype="multipart/form-data" name="grimmMgraForm" >
		<input type="hidden" name="useFormat" id="grm_useFormat" value="grimm"/>
		<h2><p align="center">Genome in grimm format</p></h2>		
    	<table id="grm_genomes">
	    </table>

	    <script>
	        initGenomesGrm(2);
	    </script>
		
		<div align = "center"> <input name="add_genome" type="button" value="add genome" onclick="addGenomeGrm(); return false;"/> </div>
		
		<p>
        	<div id = "content_text"> <strong>Genome file:</strong> </div> 
			<div id = "content"> <input type="file" id="grm_genome_file" name="genome_file"> <a href="#" onclick="clearFileGrm();">Clear</a> </div>
	    </p>
		
	    
    	<p>
    	    <strong>Known subtrees of the phylogenetic tree of the above genomes in Newick format</strong><br>
    	    If no trees are given, MGRA assumes that only terminal branches are known (as in MGR).  
    	</p>
   		
		<div id = "content"> <textarea rows="6" cols="60" name="trees" id="grm_trees"></textarea></div>

	    <p>
	        <strong>The number of stages to perform</strong>&nbsp;&nbsp;&nbsp;<input type='text' size='5' name='stages' id="grm_stages" value="3"/><br>
	        <p style="text-indent: 25px;">
				Higher values correspond to less reliable heuristics.
		        The highest value is 4 and usually it still requires manual completion (see below).
		        Smaller values require 'target' specification to produce ancestral reconstruction.
	        	It is not recommended to have stages higher than 3 if no complete phylogenetic tree is known.
			</p>
	    </p>

	    <div id="grm_targetControl">
            <a href="#" onclick="return showTargetGrm(true);">Show Target and Completion fields</a>
        </div>

        <div id="grm_targetDiv" style="display:none;">
    		<p>
    	    	<a href="#" onclick="return showTargetGrm(false);">Remove Target and Completion fields</a>
	   		</p>

    		<p>
    	    	<strong>Target</strong>&nbsp;&nbsp;&nbsp;<input type='text' size='10' name='target' id="grm_target"/><br>
    	   		<p style="text-indent: 25px;">
					By default, MGRA reconstructs all ancestral genomes but it first has to complete transformation into an identity breakpoint graph.
		        	If 'target' is specified, MGRA focuses on reconstruction of the specified ancestral genome
		        	and can produce a partial reconstruction at any point (even if the transformation is not complete).
				</p>
    		</p>
		    <p style="text-indent: 25px;">	
		        Manual (human-assisted) completion of T-consistent transformation (the last stage of MGRA).
		        Each row contains exactly five terms: `a b c d E' denoting a 2-break operating on the \vec{T}-consistent multicolor E,
		        replacing the multiedges (a,b) and (c,d) with the multiedges (a,c) and (b,d).
		        'oo' stands for a chromosome end.
		        Manual completion can be derived from visual inspection of the breakpoint graph after MGRA Stage 3.
		    </p> 
			<div id = "content">
			    <textarea rows="6" cols="60" name="completion" id="grm_completion"></textarea>
		    </div>

		    <input type="hidden" name="useTarget" id="grm_useTarget" value="0"/>
		</div> 
			<p>
				<div align = "center"> 
			        <input type="submit" value="submit form"/>
				</div>
		    </p>
    </form>
	</div> </div>
	
	<footer>
	<hr>
	MGRA 1.0 by Max Alekseyev
	</footer>
</body>
</html>
