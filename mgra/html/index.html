<!DOCTYPE html>
<html>
<head>	
	<title>MGRA</title>
	<style>
		 #menu { 
    		float: left; 
    		width: 15%;
    		padding: 5px; 
		    margin: 10px 10px 20px 5px; 
   		}

		#content_text { 
			float: left; 
		    margin: 2px 5px 0px 5px; 
		    padding: 5px; 
			width: 150px; 
   		}

		#content_text1 { 
			float: left; 
		    margin: 10px 5px 20px 5px; 
		    padding: 5px; 
			width: 150px; 
   		}

		#content {
		    margin: 10px 5px 20px 225px; 
		    padding: 5px; 
   		}

		#menu_content {
		    margin: 10px 5px 20px 16%; 
		    padding: 5px; 
   		}

		#right_text { 
			float: left; 
    		width: 100px; 
    		padding: 5px; 
		    margin: 70px 10px 20px 5px; 
		} 
	</style>

	<script type = "text/javascript">	
		var genomeCountGrm = 0;
		var genomeCountInf = 0; 

		function getClientWidth() {
			return document.compatMode=='CSS1Compat' && !window.opera?document.documentElement.clientWidth:document.body.clientWidth;
		}	

		/*Grimm format functions*/
        function addGenomeGrm() {
            genomeCountGrm++;
            var table = document.getElementById("grm_genomes");
            var row = table.insertRow(genomeCountGrm - 1);
            row.align = "left";
            row.vAlign = "top";
            var c = [];
            for (var j = 0; 1 > j; j++) {
                c[j] = row.insertCell(j);
                c[j].align = "left";
                c[j].vAlign = "top";
            }

            c[0].innerHTML =
                "<div id = \"right_text\"><strong>Genome " + genomeCountGrm + ":</strong></div>" +
                "<div id = \"content\"> <div>Name <input id='grm_alias" + genomeCountGrm + "'size='40' name='alias" + genomeCountGrm + "'></div>" +
                "<textarea id='grm_genome" + genomeCountGrm + "' name='genome" + genomeCountGrm + "' rows='6' cols='60'></textarea></div>";
        }

		function initGenomesGrm(n) {
            var table = document.getElementById("grm_genomes");
            for(var i = table.rows.length - 1; i >= 0; i--) {
                table.deleteRow(i);
            }
            genomeCountGrm = 0;
            for (var i = 0; i < n; i++) {
                addGenomeGrm();
            }
            clearFileGrm();
        }

		function clearGrimmFormat() { 
			initGenomesGrm(2);
			document.getElementById("grm_trees").value = '';
            document.getElementById("grm_stages").value = '3';
            document.getElementById("grm_target").value = '';
            document.getElementById("grm_completion").value = ''	
			showTargetGrm(false);
		} 

		function showTargetGrm(show) {
            document.getElementById('grm_targetDiv').style.display= show ? '' : 'none';
            document.getElementById('grm_targetControl').style.display=show ? 'none' : '';
            document.getElementById('grm_useTarget').value=show ? 1 : 0;
            return false;
        }

		function clearFileGrm() { 
			document.getElementById('grm_genome_file').value = '';
		} 

		function setGrimmFormat() { 
			clearGrimmFormat();
			document.getElementById('grm_widthMonitor').value = getClientWidth(); 
			document.getElementById('showInferCarsForm').style.display = 'none'; 
			document.getElementById('showGrimmForm').style.display = '';
			document.getElementById('showHelp').style.display = 'none';
		}

		/*InferCARs format functions*/
		function addGenomeInf() {
            genomeCountInf++;
            var table = document.getElementById("inf_genomes");
            var row = table.insertRow(genomeCountInf - 1);
            row.align = "left";
            row.vAlign = "top";
            var c = [];
            for (var j = 0; 1 > j; j++) {
                c[j] = row.insertCell(j);
                c[j].align = "left";
                c[j].vAlign = "top";
            }

            c[0].innerHTML =
                "<div id = \"content_text1\"><strong>Genome " + genomeCountInf + ":</strong></div>" +
                "<div id = \"content\"> <div>Name <input id='inf_alias" + genomeCountInf + "'size='40' name='alias" + genomeCountInf + "'></div></div>"
        }

		function initGenomesInf(n) {
            var table = document.getElementById("inf_genomes");
            for(var i = table.rows.length - 1; i >= 0; i--) {
                table.deleteRow(i);
            }
            genomeCountInf = 0;
            for (var i = 0; i < n; i++) {
                addGenomeInf();
            }
            clearFileInf();
        }
	
		function showTargetInf(show) {
            document.getElementById('inf_targetDiv').style.display= show ? '' : 'none';
            document.getElementById('inf_targetControl').style.display=show ? 'none' : '';
            document.getElementById('inf_useTarget').value=show ? 1 : 0;
            return false;
        }

        function clearFileInf() {
            document.getElementById('inf_genome_file').value = '';
        }

    	function clearInferCarsFormat() { 
			initGenomesInf(2); 
            document.getElementById("inf_genome").value = '';
            document.getElementById("inf_trees").value = '';
            document.getElementById("inf_stages").value = '3';
            document.getElementById("inf_target").value = '';
            document.getElementById("inf_completion").value = ''	
			showTargetInf(false);
		} 

		function setInferCarsFormat() { 
			clearInferCarsFormat();
			document.getElementById('inf_widthMonitor').value = getClientWidth(); 
			document.getElementById('showInferCarsForm').style.display = ''; 
			document.getElementById('showGrimmForm').style.display = 'none';	
			document.getElementById('showHelp').style.display = 'none'; 
		} 
	 
    	function loadFile(file) {
            var X = new XMLHttpRequest();
            X.open('GET', file, false );
            X.setRequestHeader('Content-Type', 'text/html')
            X.send('');
            return X.responseText;
        }

		/*Set example in file*/
	    function setMam6() {
            setInferCarsFormat(); 
			initGenomesInf(6); 

            document.getElementById("inf_alias1").value = 'mouse mm9';
            document.getElementById("inf_alias2").value = 'rat rn4';
            document.getElementById("inf_alias3").value = 'dog canFam2';
            document.getElementById("inf_alias4").value = 'macaque rheMac2';
            document.getElementById("inf_alias5").value = 'human hg18';
            document.getElementById("inf_alias6").value = 'chimpanzee panTro2';

            document.getElementById("inf_genome").value = loadFile('mam6/blocks6.txt');
            document.getElementById("inf_trees").value = '(((M,R),D),(Q,(H,C)))';
            document.getElementById("inf_stages").value = '4';
            document.getElementById("inf_target").value = '';
            document.getElementById("inf_completion").value = '1299h 1300h 1300t 1301t R\n'+
                                                            '1289h 1290h 1290t 1291t D\n'+
                                                            '374t 376t oo 375h R\n'+
                                                            '927t 610h 610t 609h R\n'+
                                                            '79h 81t 80t 83h Q\n'+
                                                            '81t 83h 80h 84t Q\n'+
                                                            '794h 795t 795h 796t Q\n'+
                                                            '1196h 1198h 1202t 1199t D\n';
            showTargetInf(true);
        }

        function setMam7() {
            setInferCarsFormat();
			initGenomesInf(7); 

            document.getElementById("inf_alias1").value = 'mouse mm9';
            document.getElementById("inf_alias2").value = 'rat rn4';
            document.getElementById("inf_alias3").value = 'dog canFam2';
            document.getElementById("inf_alias4").value = 'macaque rheMac2';
            document.getElementById("inf_alias5").value = 'human hg18';
            document.getElementById("inf_alias6").value = 'chimpanzee panTro2';
            document.getElementById("inf_alias7").value = 'opossum monDom4'; 
            
            document.getElementById("inf_genome").value = loadFile('mam7/blocks7.txt');
            document.getElementById("inf_trees").value = '((M,R),DOQHC)\n' +
                                                     '(MRDO,(Q,(H,C)))';
            document.getElementById("inf_stages").value = '3';
            document.getElementById("inf_target").value = '';
            document.getElementById("inf_completion").value = '';
            showTargetInf(false);
        }

		function setRosaceae() { 
			setInferCarsFormat(); 
			initGenomesInf(3); 

            document.getElementById("inf_alias1").value = 'pp prunus';
            document.getElementById("inf_alias2").value = 'fv fragaria';
            document.getElementById("inf_alias3").value = 'vv vitus';
            
            document.getElementById("inf_genome").value = loadFile('rosaceae/rosaceae.txt');
            document.getElementById("inf_trees").value = '((P,S),V)';
            document.getElementById("inf_stages").value = '3';
            document.getElementById("inf_target").value = 'PS';
            document.getElementById("inf_completion").value = '';
            showTargetInf(true);
		} 


        function setMurphy05() {
			setGrimmFormat();
            initGenomesGrm(7);

         	document.getElementById("grm_alias1").value = 'human';
			document.getElementById("grm_genome1").value = loadFile('murphy05/murphy05_1.txt');

            document.getElementById("grm_alias2").value = 'mouse';
			document.getElementById("grm_genome2").value = loadFile('murphy05/murphy05_2.txt');           

		   document.getElementById("grm_alias3").value = 'rat';
			document.getElementById("grm_genome3").value = loadFile('murphy05/murphy05_3.txt');           

            document.getElementById("grm_alias4").value = 'cat';
			document.getElementById("grm_genome4").value = loadFile('murphy05/murphy05_4.txt');     	      

            document.getElementById("grm_alias5").value = 'cattle';
			document.getElementById("grm_genome5").value = loadFile('murphy05/murphy05_5.txt');           

            document.getElementById("grm_alias6").value = 'dog';
			document.getElementById("grm_genome6").value = loadFile('murphy05/murphy05_6.txt');           

            document.getElementById("grm_alias7").value = 'pig';
			document.getElementById("grm_genome7").value = loadFile('murphy05/murphy05_7.txt');           

            document.getElementById("grm_trees").value = '((H,(M,R)),DCPW)\n'+
                                                     '((D,C),HRMPW)\n' +
                                                     '((P,W),HRMDC)';
			
            document.getElementById("grm_stages").value = '3';
            document.getElementById("grm_target").value = 'DCPW';
            document.getElementById("grm_completion").value = '';
            showTargetGrm(true);
        }

        function setToy05() {
			setGrimmFormat();
            initGenomesGrm(4);

     		document.getElementById("grm_alias1").value = 'P1';
            document.getElementById("grm_genome1").value = loadFile('toy/toyblks_1.txt');
		
	        document.getElementById("grm_alias2").value = 'P2';
		    document.getElementById("grm_genome2").value = loadFile('toy/toyblks_2.txt');
		        
		    document.getElementById("grm_alias3").value = 'P3';
		    document.getElementById("grm_genome3").value = loadFile('toy/toyblks_3.txt');
		
            document.getElementById("grm_alias4").value = 'P4';
    		document.getElementById("grm_genome4").value = loadFile('toy/toyblks_4.txt');
			
            document.getElementById("grm_trees").value = '((1,2),(3,4))';

            document.getElementById("grm_stages").value = '3';
            document.getElementById("grm_target").value = '';
            document.getElementById("grm_completion").value = '';

            showTargetGrm(false);
        }

		function setShigella() { 
			setGrimmFormat(); 
			 initGenomesGrm(6);

      		document.getElementById("grm_alias1").value = 'Shi1 S1';
			document.getElementById("grm_genome1").value = loadFile('shigella/shigella_1.txt');

            document.getElementById("grm_alias2").value = 'Shi2 S2';
			document.getElementById("grm_genome2").value = loadFile('shigella/shigella_2.txt');           

		    document.getElementById("grm_alias3").value = 'Shi3 S3';
			document.getElementById("grm_genome3").value = loadFile('shigella/shigella_3.txt');           

            document.getElementById("grm_alias4").value = 'Shi4 S4';
			document.getElementById("grm_genome4").value = loadFile('shigella/shigella_4.txt');     	      

            document.getElementById("grm_alias5").value = 'Shi5 S5';
			document.getElementById("grm_genome5").value = loadFile('shigella/shigella_5.txt');           

            document.getElementById("grm_alias6").value = 'Shi6 S6';
			document.getElementById("grm_genome6").value = loadFile('shigella/shigella_6.txt');           

            document.getElementById("grm_trees").value = '(((A,B),F),((D,C),E))';
			
            document.getElementById("grm_stages").value = '4';
       
            document.getElementById("grm_completion").value = '357h 365t 268t 321h D\n' + 
															  '400t 401h 398h 401t D\n' + 
															  '425t 426t 426h 407h B';
            showTargetGrm(true);
		} 


		function viewHelp() { 
			clearGrimmFormat();
			clearInferCarsFormat();
			document.getElementById('showInferCarsForm').style.display = 'none'; 
			document.getElementById('showGrimmForm').style.display = 'none'; 
			document.getElementById('showHelp').style.display = ''; 
		} 
	</script>
</head>
<body>
	<header> 
		<h1><p align="center"><a href="#">MGRA (Multiple Genome Rearrangements and Ancestors) web server, beta version</a></p></h1>
	</header>

	<nav id = "menu">
		<p> 
			<strong> Input formats: </strong> <br>
			<blockquote> 
				<a href="#" onclick="setInferCarsFormat(); return false;">infercars</a> <br>
				<a href="#" onclick="setGrimmFormat(); return false;">grimm</a> <br>
			</blockquote>	
			<strong> Examples: </strong> <br>
			<blockquote> 
				<a href="#" onclick="setMam6(); return false;">mam6</a> <br>
				<a href="#" onclick="setMam7(); return false;">mam7</a> <br>
				<a href="#" onclick="setRosaceae(); return false;">rosaceae</a> <br>			
		        <a href="#" onclick="setMurphy05(); return false;">murphy05</a> <br>
				<a href="#" onclick="setToy05(); return false;">toy</a> <br>
				<a href="#" onclick="setShigella(); return false;">shigella</a> <br>					        
			</blockquote>
			<a href="#" onclick="viewHelp(); return false;">How to work</a> <br>			
		</p>
	</nav>
	
	<div id = "menu_content">	
	<!--Form for infercars format-->
	<div id = "showInferCarsForm"> 
		<form method="post" action="http://127.0.0.1:8080" enctype="multipart/form-data" name="inferCarsMgraForm">

		<input type="hidden" name="useFormat" id="inf_useFormat" value="infercars"/>
		<input type="hidden" name="widthMonitor" id="inf_widthMonitor" value=""/>
		
		<h2><p align="center">Genome in infercars format</p></h2>		

		<table id="inf_genomes">
	    </table>

	    <script>
	        initGenomesInf(2);
	    </script>
		
		<div align = "center"> <input name="add_genome" type="button" value="add genome" onclick="addGenomeInf(); return false;"/> </div>

		<p>
        	<div id ="content_text"> <strong>Genome file:</strong> </div> 
			<div id ="content"> <input type="file" id="inf_genome_file" name="genome_file"> <a href="#" onclick="clearFileInf();">Clear</a> </div>
	    </p>

		<div id ="right_text"> <strong>Genome:</strong></div>
		<div id ="content"> <textarea id='inf_genome' name='genome' rows='10' cols='60'></textarea></div>
		<p>
    	    <strong>Known subtrees of the phylogenetic tree of the above genomes in Newick format</strong><br>
    	    If no trees are given, MGRA assumes that only terminal branches are known (as in MGR).  
    	</p>
   		
		<div id = "content"> <textarea rows="5" cols="60" name="trees" id="inf_trees"></textarea></div>

	    <p>
	        <strong>The number of stages to perform</strong>&nbsp;&nbsp;&nbsp;<input type='text' size='5' name='stages' id="inf_stages" value="3"/><br>
	        <p style="text-indent: 25px;">
				Higher values correspond to less reliable heuristics.
		        The highest value is 4 and usually it still requires manual completion (see below).
		        Smaller values require 'target' specification to produce ancestral reconstruction.
	        	It is not recommended to have stages higher than 3 if no complete phylogenetic tree is known.
			</p>
	    </p>

	    <div id="inf_targetControl">
            <a href="#" onclick="return showTargetInf(true);">Show Target and Completion fields</a>
        </div>

        <div id="inf_targetDiv" style="display:none;">
    		<p>
    	    	<a href="#" onclick="return showTargetInf(false);">Remove Target and Completion fields</a>
	   		</p>

    		<p>
    	    	<strong>Target</strong>&nbsp;&nbsp;&nbsp;<input type='text' size='10' name='target' id="inf_target"/><br>
    	   		<p style="text-indent: 25px;">
					By default, MGRA reconstructs all ancestral genomes but it first has to complete transformation into an identity breakpoint graph.
		        	If 'target' is specified, MGRA focuses on reconstruction of the specified ancestral genome
		        	and can produce a partial reconstruction at any point (even if the transformation is not complete).
				</p>
    		</p>
		    <p style="text-indent: 25px;">	
		        Manual (human-assisted) completion of T-consistent transformation (the last stage of MGRA).
		        Each row contains exactly five terms: `a b c d E' denoting a 2-break operating on the \vec{T}-consistent multicolor E,
		        replacing the multiedges (a,b) and (c,d) with the multiedges (a,c) and (b,d).
		        'oo' stands for a chromosome end.
		        Manual completion can be derived from visual inspection of the breakpoint graph after MGRA Stage 3.
		    </p> 
			<div id = "content">
			    <textarea rows="5" cols="60" name="completion" id="inf_completion"></textarea>
		    </div>

		    <input type="hidden" name="useTarget" id="inf_useTarget" value="0"/>
		</div> 
			<p>
				<div align = "center"> 
			        <input type="submit" value="run calculate"/>
				</div>
		    </p>
    </form>
	</div> 


	<!--Form for grimm format-->
	<div id = "showGrimmForm" style="display:none;"> 
	<form method="post" action="http://127.0.0.1:8080" enctype="multipart/form-data" name="grimmMgraForm" >
		<input type="hidden" name="useFormat" id="grm_useFormat" value="grimm"/>
		<input type="hidden" name="widthMonitor" id="grm_widthMonitor" value=""/>
	
		<h2><p align="center">Genome in grimm format</p></h2>		
    	<table id="grm_genomes">
	    </table>

	    <script>
	        initGenomesGrm(2);
	    </script>
		
		<div align = "center"> <input name="add_genome" type="button" value="add genome" onclick="addGenomeGrm(); return false;"/> </div>
		
		<p>
        	<div id = "content_text"> <strong>Genome file:</strong> </div> 
			<div id = "content"> <input type="file" id="grm_genome_file" name="genome_file"> <a href="#" onclick="clearFileGrm();">Clear</a> </div>
	    </p>
		
	    
    	<p>
    	    <strong>Known subtrees of the phylogenetic tree of the above genomes in Newick format</strong><br>
    	    If no trees are given, MGRA assumes that only terminal branches are known (as in MGR).  
    	</p>
   		
		<div id = "content"> <textarea rows="6" cols="60" name="trees" id="grm_trees"></textarea></div>

	    <p>
	        <strong>The number of stages to perform</strong>&nbsp;&nbsp;&nbsp;<input type='text' size='5' name='stages' id="grm_stages" value="3"/><br>
	        <p style="text-indent: 25px;">
				Higher values correspond to less reliable heuristics.
		        The highest value is 4 and usually it still requires manual completion (see below).
		        Smaller values require 'target' specification to produce ancestral reconstruction.
	        	It is not recommended to have stages higher than 3 if no complete phylogenetic tree is known.
			</p>
	    </p>

	    <div id="grm_targetControl">
            <a href="#" onclick="return showTargetGrm(true);">Show Target and Completion fields</a>
        </div>

        <div id="grm_targetDiv" style="display:none;">
    		<p>
    	    	<a href="#" onclick="return showTargetGrm(false);">Remove Target and Completion fields</a>
	   		</p>

    		<p>
    	    	<strong>Target</strong>&nbsp;&nbsp;&nbsp;<input type='text' size='10' name='target' id="grm_target"/><br>
    	   		<p style="text-indent: 25px;">
					By default, MGRA reconstructs all ancestral genomes but it first has to complete transformation into an identity breakpoint graph.
		        	If 'target' is specified, MGRA focuses on reconstruction of the specified ancestral genome
		        	and can produce a partial reconstruction at any point (even if the transformation is not complete).
				</p>
    		</p>
		    <p style="text-indent: 25px;">	
		        Manual (human-assisted) completion of T-consistent transformation (the last stage of MGRA).
		        Each row contains exactly five terms: `a b c d E' denoting a 2-break operating on the \vec{T}-consistent multicolor E,
		        replacing the multiedges (a,b) and (c,d) with the multiedges (a,c) and (b,d).
		        'oo' stands for a chromosome end.
		        Manual completion can be derived from visual inspection of the breakpoint graph after MGRA Stage 3.
		    </p> 
			<div id = "content">
			    <textarea rows="6" cols="60" name="completion" id="grm_completion"></textarea>
		    </div>

		    <input type="hidden" name="useTarget" id="grm_useTarget" value="0"/>
		</div> 
			<p>
				<div align = "center"> 
			        <input type="submit" value="run calculate"/>
				</div>
		    </p>
    </form>
	</div> </div>

	<div id = "showHelp" style="display:none;"> <div id = "content">
		<h2><p align="center">How to work</p></h2>		
    	This is web server provide interface for working <a href="http://cseweb.ucsd.edu/~ppevzner/download/mgra20090215.zip">MGRA algorithm</a>. 
		<h3><u>Algorithm:</u></h3>		
		<ol type = "1">
		<li>
			<strong>You need choose input data format. Server supported two input formats are grimm and infercars. </strong> 
		</li>
		<br>
		<li>
			<strong>You enter their data in form:</strong> 
			<ul type="square">
			<li><u>Grimm form</u> <br>
				Name of genome must be a single unique letter.
			</li>
			<br>
			<li><u>Infercars form</u> <br>
				Name of genome must be a single unique letter.
			</li>
			</ul>
			<br>
			We recomended see examples (mam6, mam7, rosaceae - infercars format, murphy and toy - grimm format) before they enter their data. 	
		</li>
		<br>
		<li>
			<strong> Push button "run calculate", and server will begin processing the data, which may take some time. </strong>
		</li>
		<br>
		<li>
			<strong> Information on what step is processing the data will be displayed on the screen. </strong> 
		</li>
		<br>
		<li>
			<strong> After completion of data processing, it will display the phylogenetic tree. </strong> <br>
			Tree nodes can be placed as you wish by dragging the mouse. <br> 
			If you double click on the yellow tree node, you saw information of genome and genome transformation.    
			<ul type="square">
			<br>
			<li><u>Genome</u> <br>
				Genome represented as the sequence of synteny blocks. Each synteny block has its number and oriented to the head or to the tail. If we will 				use numbers for the representation it will be pretty hard to figure the length of the genome or its part. That's why we use > and &lt; to 					represent synteny blocks, depending on their orientation. The synteny block number can be viewed as title to the link associated with > or 					&lt; sign. 
			</li>
			<br>
			<li><u>Genome transformation</u> <br>
				The original MGRA outputs only the ends of the breaks of the transformations. We show this ends using h and t letters. Each end has its own 				color that allows us to show where it goes after the transformation. We use similar colors for the ends that are clued after the 					transformation.
			</li>
		</li>
		<ol>

		Name genome is one symbol
	</div>
	</div>	

	<footer>
	<hr>
	MGRA 1.0 &copy; 2008,09 by Max Alekseyev
	</footer>
</body>
</html>
